<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Document</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="./style.css">
    <script src="./scripts/game-factory.js" type="application/javascript"></script>
    <script src="./scripts/backend-client-factory.js" type="application/javascript"></script>
    <script src="./scripts/dom-client-factory.js" type="application/javascript"></script>
    <script src="./scripts/initialize.js" type="application/javascript"></script>
</head>
<body>
<main>
    <h1>Conways Game of Life</h1>
    <div id="conway"></div>
</main>
</body>

<script type="application/javascript">
    (async () => {
        
        /**
         * @param { string | undefined } seedOrUndefined
         * @returns { State | undefined }
         */
        const parseSeed = (seedOrUndefined) => seedOrUndefined === undefined
            ? undefined
            : JSON.parse(decodeURIComponent(seedOrUndefined))
        
        const urlParams = new URLSearchParams(location.search);
        const turnSpeedInMs = parseInt(urlParams.get('turn-speed') || "1000")
        
        const turn = parseInt(urlParams.get('turn') || "0")
        const color = urlParams.get('color') || "binary";
        const seedOrUndefined = parseSeed(urlParams.get('seed'))
        
        console.log("Initializing Conway's game of life", { turn, color, seed: seedOrUndefined })
        const game = await conway.initialize('conway', "/api/conway", turnSpeedInMs, turn, color, seedOrUndefined);

        window.conway.isMainLoopRunning = true;
        game.unpause();
})();
</script>
</html>